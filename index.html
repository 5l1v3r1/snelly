

<body onload="onLoad();">

<canvas id="canvas" style="border: none;" width="500" height="500"></canvas>
<br/>

<div id="container">
</div>


<script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="js/three/three.min.js"></script>
<script type="text/javascript" src="js/three/controls/OrbitControls.js"></script>
<script type="text/javascript" src="js/require.js"></script>

<script type="text/javascript" src="js/gl.js"></script>
<script type="text/javascript" src="js/renderer.js"></script>

<script type="text/javascript">

/*  dispersion visualization
    -------------------------

	For now, single light =  laser at X0, pointed toward W0,  with assumed emission spectrum

	Make a texture F containing a pixel per photon frequency sample.
	Make vec4 textures X, X' and W, W' also each containing a pixel per frequency sample 
	Initialize textures X = X0, and W = W0 (the location and direction of a 'laser beam' emitter)

	for i = 1 to N/B    (B = batch size)
		
		for each ray sample:   X'_i = trace(X_i, W_i) given F_i
		                       W'_i = sample(X'_i, W_i) given F_i

		drawLine(X_i, X'_i)
		
		X_i = X'_i
		W_i = W'_i



	dispersion pathtracing
	----------------------

	Goal is interesting images specifically of dispersive refraction in solid dielectric media.
	Very similar to shadertoy, except we maintain a radiance buffer, and 
	And 

*/

var frame;

// THREE.js OrbitControls
var controls;

// Renderer object
var renderer;

// shim layer with setTimeout fallback
window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          function( callback ){
            window.setTimeout(callback, 1000 / 60);
          };
})();


// todo:  move all GL boilerplate into javascript objects, a la Tantalum GL

// todo: use bl.ocks.org to serve the webGL app publicly ..
// (or at least, the minified version of it, e.g. use r.js to minify)


function onLoad()
{
	frame = 0;

	var canvas = document.getElementById('canvas');
	canvas.width  = window.innerWidth;
	canvas.height = window.innerHeight;

	window.addEventListener( 'resize', onWindowResize, false );

	// Instantiate renderer object
	renderer = new Renderer(canvas.width, canvas.height);

	// Create user control system for camera
	controls = new THREE.OrbitControls( renderer.getCamera() );
	controls.addEventListener( 'change', camChanged );

	animateLoop();
}



function camChanged()
{
	renderer.render();
}

function animateLoop() 
{
	//console.log("frame: " + frame);
	requestAnimFrame(animateLoop);

	controls.update();

	renderer.render();

	frame = frame+1;
}


function onWindowResize() 
{
	canvas.width  = window.innerWidth;
	canvas.height = window.innerHeight;

	renderer.resize(canvas.width, canvas.height);
	renderer.render();
}


</script>

</body>


