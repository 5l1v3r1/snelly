

<body onload="onLoad();">

 <head>
<link rel="stylesheet" type="text/css" href="style.css">
</head>

<div id="container">
    <div id="webglContainer"></div> <canvas id="render-canvas"></canvas>
    <div id="threeContainer"></div> <canvas id="ui-canvas"></canvas>
</div>

<script type="text/javascript" src="js/thirdparty/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="js/thirdparty/three/three.min.js"></script>
<script type="text/javascript" src="js/thirdparty/three/libs/stats.min.js"></script>
<script type="text/javascript" src="js/thirdparty/three/libs/dat.gui.min.js"></script>
<script type="text/javascript" src="js/thirdparty/three/controls/OrbitControls.js"></script>

<script type="text/javascript" src="js/shaders.js"></script>
<script type="text/javascript" src="js/gl.js"></script>
<script type="text/javascript" src="js/laser.js"></script>
<script type="text/javascript" src="js/gui.js"></script>
<script type="text/javascript" src="js/raystate.js"></script>

<script type="text/javascript" src="js/wavelengthToRgb.js"></script>
<script type="text/javascript" src="js/materials.js"></script>
<script type="text/javascript" src="js/spectra.js"></script>
<script type="text/javascript" src="js/scenes/scenes.js"></script>

<script type="text/javascript" src="js/pathtracer.js"></script>
<script type="text/javascript" src="js/renderer.js"></script>

<?/* ----------------------------*/?>
<?/*    scene definition files   */?>
<?/* ----------------------------*/?>

<script type="text/javascript" src="js/scenes/sphere.js"></script>
<script type="text/javascript" src="js/scenes/box.js"></script>
<script type="text/javascript" src="js/scenes/fibre.js"></script>


<?/* ----------------------------*/?>


<script type="text/javascript">

// Renderer object
var renderer;
var pathtracer;


// GUI object
var gui;

// shim layer with setTimeout fallback
window.requestAnimFrame = (function(){
  return  window.requestAnimationFrame       ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame    ||
          function( callback ){
            window.setTimeout(callback, 1000/60);
          };
})();

function onLoad()
{
	window.addEventListener( 'resize', onWindowResize, false );

	// Instantiate renderer object
	renderer = new Renderer();
	
	// Instantiate scenes and materials
	createScenes(renderer);
	createMaterials(renderer);
	createSpectra(renderer);
	
	// Load the initial scene and material
	renderer.loadScene("sphere");
	renderer.loadMaterial("glass_bk7");
	renderer.loadSpectrum("flat");

	pathtracer = new Pathtracer();

	// Create dat gui
	gui = new GUI(renderer);

	// Begin rendering
	animateLoop();
}

function camChanged()
{
	//renderer.reset();
	pathtracer.reset();
}

function animateLoop() 
{
	//renderer.render();
	pathtracer.render();
	requestAnimFrame(animateLoop);
}

function onWindowResize() 
{
	var render_canvas = document.getElementById('render-canvas');
	render_canvas.width  = window.innerWidth;
	render_canvas.height = window.innerHeight;

	var ui_canvas = document.getElementById('ui-canvas');
	ui_canvas.width  = window.innerWidth;
	ui_canvas.height = window.innerHeight;

	renderer.resize(render_canvas.width, render_canvas.height);
	renderer.render();

	pathtracer.resize(render_canvas.width, render_canvas.height);
	pathtracer.render();
}

</script>
</body>


